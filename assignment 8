# Directory: user_auth_project

# Step 1: manage.py (auto-generated by Django)
# Skipped here. Use `django-admin startproject user_auth_project` to create.

# Step 2: settings.py (inside user_auth_project/user_auth_project/settings.py)
# Add the following lines/changes:

INSTALLED_APPS = [
    ...,
    'accounts',
    'django.contrib.sessions',
    'django.contrib.messages',
]

LOGIN_REDIRECT_URL = '/home/'
LOGOUT_REDIRECT_URL = '/login/'

TEMPLATES = [
    {
        ...,
        'DIRS': [BASE_DIR / 'templates'],
        ...
    },
]

# Step 3: accounts/views.py
from django.shortcuts import render, redirect
from django.contrib.auth.forms import UserCreationForm, AuthenticationForm
from django.contrib.auth import login, logout, authenticate
from django.contrib.auth.decorators import login_required

def register_view(request):
    if request.method == 'POST':
        form = UserCreationForm(request.POST)
        if form.is_valid():
            user = form.save()
            login(request, user)
            return redirect('/home/')
    else:
        form = UserCreationForm()
    return render(request, 'accounts/register.html', {'form': form})

def login_view(request):
    if request.method == 'POST':
        form = AuthenticationForm(data=request.POST)
        if form.is_valid():
            user = form.get_user()
            login(request, user)
            return redirect('/home/')
    else:
        form = AuthenticationForm()
    return render(request, 'accounts/login.html', {'form': form})

def logout_view(request):
    logout(request)
    return redirect('/login/')

@login_required
def home_view(request):
    return render(request, 'accounts/home.html')

# Step 4: accounts/urls.py
from django.urls import path
from . import views

urlpatterns = [
    path('register/', views.register_view, name='register'),
    path('login/', views.login_view, name='login'),
    path('logout/', views.logout_view, name='logout'),
    path('home/', views.home_view, name='home'),
]

# Step 5: user_auth_project/urls.py
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', include('accounts.urls')),
]

# Step 6: Templates
# Create templates/accounts/register.html
'''html
<h2>Register</h2>
<form method="post">{% csrf_token %}
  {{ form.as_p }}
  <button type="submit">Register</button>
</form>
'''

# Create templates/accounts/login.html
'''html
<h2>Login</h2>
<form method="post">{% csrf_token %}
  {{ form.as_p }}
  <button type="submit">Login</button>
</form>
'''

# Create templates/accounts/home.html
'''html
<h2>Welcome {{ request.user.username }}</h2>
<p><a href="/logout/">Logout</a></p>
'''

# Step 7: requirements.txt
Django>=4.0

# Final Step:
# python manage.py makemigrations
# python manage.py migrate
# python manage.py runserver
